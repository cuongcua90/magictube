angular.module("magicListenApp",["ngRoute","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:""})}]).run(function(){var a=document.createElement("script");a.src="//www.youtube.com/iframe_api";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}),angular.module("magicListenApp").controller("MainCtrl",["$scope","$log","$window","$http","ExternalMusicService","PlayerService",function(a,b,c,d,e,f){a.searchAll=function(b){a.searchYoutube(b),a.searchLastFmTrackInfo(b),a.searchLastFmAlbumInfo(b),a.searchLastFmArtistInfo(b)},a.addVideoItem=function(c){a.playerControl.supports_html5_storage()&&b.log("great"),a.playerControl.addVideoItem(c),player||(player=new YT.Player("player",{height:"270",width:"480",videoId:a.playerControl.config.list[a.playerControl.config.index].id,playerVars:{controls:"0",color:"red",showinfo:"0"},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}}),a.playerControl.config.isValid=!0)},a.removeVideoByIndex=function(b){a.playerControl.config.list.splice(b,1),a.playerControl.config.index===b&&(b===a.playerControl.config.list.length&&a.playerControl.config.index--,a.playerControl.config.loadVideoByIndex())},a.searchYoutube=function(b){e.searchYoutube(b).success(function(b){a.resultYoutubes=b.data})},a.getRelatedYoutubeVideo=function(b){e.getRelatedYoutubeVideo(b).success(function(b){a.videoRelateds=b.data})},a.searchLastFmTrackInfo=function(b){e.track.search(b).success(function(b){a.lastFmTracks=b.results.trackmatches.track})},a.suggestQueries=function(a){var c="http://suggestqueries.google.com/complete/search",e={ds:"yt",client:"youtube",hjson:"t",q:a,callback:"JSON_CALLBACK"};return d.jsonp(c,{params:e}).then(function(a){b.log(a.data[1]);var c=[];return angular.forEach(a.data[1],function(a){c.push(a[0])}),b.log(c),c})},a.searchLastFmAlbumInfo=function(a){e.album.search(a).success(function(){})},a.searchLastFmArtistInfo=function(a){e.artist.search(a).success(function(){})};var g=["Thu Hien","Thu Hien","Anh tho","Ngoc tan","Dau phai boi mua thu","Shakira","Che Linh","Enya"],h=Math.floor(Math.random()*g.length);a.searchKeyword=g[h],a.searchYoutube(a.searchKeyword),a.playerControl=f}]);var apiExternalMusic=function(a){var b="http://gdata.youtube.com/feeds/api/videos?q=",c="http://ws.audioscrobbler.com/2.0/",d="eb1b9816c22aa3985aa863c03cc738cb",e=function(a){},f={};f.searchYoutube=function(c){var d=b+encodeURIComponent(c),e={format:5,"max-results":12,v:2,alt:"jsonc"};return a.get(d,{params:e})},f.getRelatedYoutubeVideo=function(b){var c="http://gdata.youtube.com/feeds/api/videos/"+b+"/related",d={v:2,alt:"jsonc"};return a.get(c,{params:d})},f.suggestQueries=function(b){var c="http://suggestqueries.google.com/complete/search",d={ds:"yt",client:"youtube",hjson:"t",q:b,callback:"JSON_CALLBACK"};return a.jsonp(c,{params:d})};var e=function(b,e,f){f.format="json",f.api_key=d,f.method=b;var g=c+"?";return a.get(g,{params:f})};return f.track={search:function(a){var b={track:a,limit:30};return e("track.search",a,b)}},f.album={search:function(a){var b={album:a,limit:3};return e("album.search",a,b)}},f.artist={search:function(a){var b={artist:a,limit:3};return e("artist.search",a,b)}},f};angular.module("magicListenApp").factory("ExternalMusicService",["$http",apiExternalMusic]);var playerService=function(a,b,c){a.onYouTubeIframeAPIReady=function(){},a.onPlayerReady=function(a){a.target.playVideo()},a.onPlayerStateChange=function(a){a.data==YT.PlayerState.ENDED&&d.nextVideo(),c.$apply(function(){d.config.status=a.data})};var d={config:{volume:50,isShow:!1,isShuffle:!1,isRepeate:!1,index:0,status:-1,list:[],loadVideoByIndex:function(){this.list.length>this.index&&player.loadVideoById(this.list[this.index].id)}},supports_html5_storage:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}},addVideoItem:function(a){this.config.list.push(a)},isPlayable:function(){return this.config.list.length>0},pauseVideo:function(){player.pauseVideo()},changeIndex:function(a){this.config.index!==a&&(this.config.index=a,this.config.loadVideoByIndex())},playVideo:function(){var a=player.getDuration();a>0&&player.playVideo()},nextVideo:function(){0==this.config.isShuffle&&this.config.index<this.config.list.length&&(this.config.index++,this.config.loadVideoByIndex())},previousVideo:function(){0==this.config.isShuffle&&this.config.index>0&&(this.config.index--,this.config.loadVideoByIndex())}};return d};angular.module("magicListenApp").factory("PlayerService",["$window","$log","$rootScope",playerService]);