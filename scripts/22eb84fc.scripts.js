angular.module("magicListenApp",["ngRoute","ui.bootstrap","LocalStorageModule"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:""})}]).run(function(){var a=document.createElement("script");a.src="//www.youtube.com/iframe_api";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)});var apiExternalMusic=function(a){var b="http://gdata.youtube.com/feeds/api/videos?q=",c="http://ws.audioscrobbler.com/2.0/",d="eb1b9816c22aa3985aa863c03cc738cb",e=function(a){},f={};f.searchYoutube=function(c){var d=b+encodeURIComponent(c),e={format:5,"max-results":6,v:2,alt:"jsonc"};return a.get(d,{params:e})},f.getRelatedYoutubeVideo=function(b){var c="http://gdata.youtube.com/feeds/api/videos/"+b+"/related",d={v:2,alt:"jsonc","max-results":6};return a.get(c,{params:d})},f.suggestQueries=function(b){var c="http://suggestqueries.google.com/complete/search",d={ds:"yt",client:"youtube",hjson:"t",q:b,callback:"JSON_CALLBACK"};return a.jsonp(c,{params:d})};var e=function(b,e,f){f.format="json",f.api_key=d,f.method=b;var g=c+"?";return a.get(g,{params:f})};return f.track={search:function(a){var b={track:a,limit:30};return e("track.search",a,b)}},f.album={search:function(a){var b={album:a,limit:3};return e("album.search",a,b)}},f.artist={search:function(a){var b={artist:a,limit:3};return e("artist.search",a,b)}},f};angular.module("magicListenApp").factory("ExternalMusicService",["$http",apiExternalMusic]);var playerService=function(a,b,c){var d={config:{isReady:!1,volume:50,isShow:!1,isShuffle:!1,isRepeate:!1,index:0,status:-1,list:[]},loadVideoByIndex:function(){this.config.list.length>this.config.index&&player.loadVideoById(this.config.list[this.config.index].id)},addVideoItem:function(a){this.config.list.push(a)},isPlayable:function(){return this.config.list.length>0},pauseVideo:function(){player.pauseVideo()},changeIndex:function(a){this.config.index!==a&&(this.config.index=a,this.loadVideoByIndex())},playVideo:function(){var a=player.getDuration();a>0&&player.playVideo()},nextVideo:function(){0==this.config.isShuffle&&(this.config.index<this.config.list.length-1?(this.config.index++,this.loadVideoByIndex()):(this.config.index=0,this.loadVideoByIndex()))},previousVideo:function(){0==this.config.isShuffle&&this.config.index>0&&(this.config.index--,this.loadVideoByIndex())}};return a.onYouTubeIframeAPIReady=function(){d.config.isReady=!0},a.onPlayerReady=function(a){a.target.playVideo()},a.onPlayerStateChange=function(a){a.data==YT.PlayerState.ENDED&&d.nextVideo(),c.$apply(function(){d.config.status=a.data})},d};angular.module("magicListenApp").factory("PlayerService",["$window","$log","$rootScope","$timeout",playerService]),angular.module("magicListenApp").controller("MainCtrl",["$scope","$timeout","$log","$window","$http","ExternalMusicService","PlayerService","localStorageService",function(a,b,c,d,e,f,g,h){a.searchAll=function(b){a.searchYoutube(b),a.searchLastFmTrackInfo(b),a.searchLastFmAlbumInfo(b),a.searchLastFmArtistInfo(b)},a.initialPlayer=function(){player||(player=new YT.Player("player",{height:"270",width:"480",videoId:a.playerControl.config.list[a.playerControl.config.index].id,playerVars:{controls:"1",color:"red",showinfo:"0"},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}}),a.playerControl.config.isValid=!0)},a.addVideoItem=function(b){a.playerControl.addVideoItem(b),a.initialPlayer(),a.addListToLocalStorage()},a.removeVideoByIndex=function(b){g.config.list.splice(b,1),c.log(b),c.log(a.playerControl.config.list.length),c.log(a.playerControl.config.index),a.playerControl.config.index===b&&(b===a.playerControl.config.list.length&&a.playerControl.config.index--,a.playerControl.loadVideoByIndex()),a.addListToLocalStorage()},a.searchYoutube=function(b){f.searchYoutube(b).success(function(b){a.resultYoutubes=b.data})},a.getRelatedYoutubeVideo=function(b){f.getRelatedYoutubeVideo(b).success(function(b){a.videoRelateds=b.data})},a.searchLastFmTrackInfo=function(b){f.track.search(b).success(function(b){a.lastFmTracks=b.results.trackmatches.track})},a.suggestQueries=function(a){var b="http://suggestqueries.google.com/complete/search",d={ds:"yt",client:"youtube",hjson:"t",q:a,callback:"JSON_CALLBACK"};return e.jsonp(b,{params:d}).then(function(a){c.log(a.data[1]);var b=[];return angular.forEach(a.data[1],function(a){b.push(a[0])}),b})},a.searchLastFmAlbumInfo=function(a){f.album.search(a).success(function(){})},a.searchLastFmArtistInfo=function(a){f.artist.search(a).success(function(){})},a.addListToLocalStorage=function(){h.add("magicListConfig",a.playerControl.config)},a.initialValue=function(){};var i=["Thu Hien","Thu Hien","Anh tho","Ngoc tan","Dau phai boi mua thu","Shakira","Che Linh","Enya"],j=Math.floor(Math.random()*i.length);a.searchKeyword=i[j],a.searchYoutube(a.searchKeyword),a.playerControl=g;var k=h.get("magicListConfig");null!==k&&(a.playerControl.config=k,a.playerControl.config.isReady=!1),a.playerControl.config.list.length>0&&(a.playerControl.config.isReady?a.initialPlayer():b(function(){a.playerControl.config.isReady&&a.initialPlayer()},2e3)),a.storageType="Local storage",h.isSupported||(a.storageType="Cookie")}]);